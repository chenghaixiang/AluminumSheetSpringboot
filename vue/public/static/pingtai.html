<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!-- <link rel="stylesheet" href="./fonts/font.css" /> -->
    <link rel="stylesheet" href="./css/bootstrap.min.css" />
    <link rel="stylesheet" href="./css/main.css" />
    <link rel="stylesheet" href="./css/jq22.css" />
    <script src="https://cdn.bootcss.com/html2canvas/0.5.0-beta4/html2canvas.js"></script>
    <script src="./js/jquery.min.js"></script>
    <script src="./js/jquery-1.11.0.js"></script>
    <style>
        .BMap_scaleTxt{
            color: #fff!important;
        }
    </style>
</head>
<body>
<div class="main" id="appIndex">

    <div class="content">

        <div class="leftBox col-md-2">
            <div class="pingfen">
                <div>
                    <div class="pfTitle">
                        <img src="img/aqpf.png" alt="" />
                        <span class="titleText">安全评分</span>
                    </div>
                    <div class="pfcontent">
                        <div class="leftBox">
                            <img src="img/aqdj.png" alt="" />
                            <span>安全等级</span>
                        </div>
                        <div id="echartAqpf" style="width:105px;height:105px;padding-left: 20px;margin-bottom: 32px;"></div>
                    </div>
                </div>
            </div>
            <div class="paimin">
                <div>
                    <div class="pfTitle" style="margin-bottom: 30px;">
                        <img style="margin-right: 10px;" src="img/jzaqpf.png" alt="" />
                        <span class="titleText">车间评分排名</span>
                    </div>
                    <div id="FontScroll">
                        <ul>
                            <li>
                                <a href="#">
                                    <span class="leftSpan">105车间 </span>
                                    <span>70</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <span class="leftSpan">106车间 </span>
                                    <span>75</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <span class="leftSpan">257车间 </span>
                                    <span>71</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <span class="leftSpan">156车间 </span>
                                    <span>65</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <span class="leftSpan">125车间 </span>
                                    <span>60</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="top10">
                <div>
                    <div class="pfTitle" style="margin-bottom: 30px;">
                        <img style="margin-right: 10px;" src="img/aqyh.png" alt="" />
                        <span class="titleText">安全隐患TOP10</span>
                    </div>

                </div>
            </div>
        </div>
        <div class="middleBox col-md-8">
            <div class="baiduMap">
                <div id="container">
                    <button  onclick="start1()">开始检测</button>
                    <button onclick="int=window.clearInterval(int)">停止</button>
                    <video width="100%" height="705px" controls id="video">
                        <source src="img/047C478D4BCE66C600589F08029CB58A.mp4" type="video/mp4">
                        您的浏览器不支持Video标签。
                    </video>
                </div>
            </div>
            <div class="tongjiList">
                <div>
                    <div class="col-md-3" style="margin: 0 15px;position: relative;">
                        <div style="justify-content: center;position: relative;top: 22px;" class="pfTitle">
                            <img style="margin-right: 10px;" src="img/xfjs.png" alt="" />
                            <span class="titleText">缺陷检测系统</span>
                        </div>
                        <!--                 <img src="img/xfjsxt.png" alt="" />-->
                        <div id="echartsxfjs" style="width:100%;height:180px;"></div>
                    </div>
                    <div class="comLine"></div>
                    <div class="col-md-3" style="margin: 0 15px;position: relative;">
                        <div style="justify-content: center;position: relative; top: 22px;
            " class="pfTitle">
                            <img style="margin-right: 10px;" src="img/ldbj.png" alt="" />
                            <span class="titleText">联动报警统计</span>
                        </div>

                        <div id="echartsldbj" style="width:100%;height:180px;margin-top: 10px;"></div>

                    </div>
                    <div class="comLine"></div>
                    <div class="col-md-3" style="margin: 0 15px;position: relative;">
                        <div style="justify-content: center;position: relative; top: 22px;" class="pfTitle">
                            <img style="margin-right: 10px;" src="img/jgbj.png" alt="" />
                            <span class="titleText">监管报警统计</span>
                        </div>
                        <div id="echartsjgbj" style="width:100%;height:180px;"></div>

                    </div>
                    <div class="comLine"></div>
                    <div class="col-md-3" style="margin: 0 15px;position: relative;">
                        <div
                                style="justify-content: center;margin-bottom: 3px;margin-top: 30px;"
                                class="pfTitle"
                        >
                            <img style="margin-right: 10px;" src="img/rcxj.png" alt="" />
                            <span class="titleText">日常巡检统计</span>
                        </div>

                        <div id="echartsrcxj" style="width:100%;height:180px;"></div>

                    </div>
                </div>
            </div>
        </div>
        <div class="rightBox col-md-2">
            <div class="weihutj">
                <div>
                    <div style="margin-left: 27px;" class="pfTitle">
                        <img style="margin-right: 10px;" src="img/whtj.png" alt="" />
                        <span class="titleText">设备统计</span>
                    </div>
                    <div class="pfcontent flexrow">
                        <div
                                style="width: 120px;"
                                class="leftBox flexcolom"
                        >
                            <div class="sbwx">
                                <span class="sbxanim animText">69</span>
                                <span class="smtext sbwxtext">设备维修</span>
                            </div>
                        </div>

                        <div class="flexcolom" style="margin: 0 8px;">
                            <div id="echartWbtj" style="width:100px;height:100px;"></div>
                            <span style="margin-top: 20px;" class="smtext"
                            >维修率</span
                            >
                        </div>
                    </div>
                </div>
            </div>
            <div class="guzhangtj">
                <div>
                    <div style="margin: 0 15px;position: relative;">
                        <div
                                style="justify-content: flex-start;margin-bottom: 3px;"
                                class="pfTitle"
                        >
                            <img style="margin-right: 10px;" src="img/gzt.png" alt="" />
                            <span class="titleText">缺陷统计</span>
                        </div>

                        <div id="echartsgztj" style="width:100%;height:180px;"></div>

                    </div>
                </div>
            </div>
            <div class="huojingtj">
                <div>
                    <div style="margin: 0 15px;position: relative;">
                        <div
                                style="justify-content: flex-start;margin-bottom: 3px;"
                                class="pfTitle"
                        >
                            <img style="margin-right: 10px;" src="img/hj.png" alt="" />
                            <span class="titleText">铝片统计</span>
                        </div>

                        <div id="echartshjtj" style="width:100%;height:180px;left: 10px;"></div>

                    </div>
                </div>
            </div>
            <div class="zhifatj">
                <div class="flexcolom">
                    <div id="echartszfjgtj" style="width:100%;height:180px;padding: 0 12px;top:-18px"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="js/jquery.min.js"></script>
<script src="js/vue.min.js"></script>
<script src="js/echarts.min.js"></script>
<script src="js/walden.js"></script>
<script src="js/roma.js"></script>
<script src="js/jquery.countUp.js"></script>
<script src="js/fontscroll.js"></script>
<script src="js/main.js"></script>
<script src="js/echart.js"></script>

<script type="text/javascript">
    function cheis(){
        const video = document.getElementById('video');
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        ctx.drawImage(video, 0, 0);

        // download picture
        var base64=canvas.toDataURL('image/jpeg');
        var jietuname=`${Date.now()}`;
        var imgfile=dataURLtoFile(base64,jietuname+'.jpg');
        var xhr=new XMLHttpRequest();
        var fd=new FormData();
        xhr.open('POST','http://localhost:9090/file/upload');
        fd.append("file",imgfile,imgfile.name);
        console.log(imgfile);
        console.log(fd);
        xhr.send(fd);
        // const a = document.createElement('a');
        // a.href = canvas.toDataURL('image/jpeg');
        // a.download = `${Date.now()}`;
        // // var pngname=`${Date.now()}`;
        // $.post("http://172.18.35.233:9090/file1/jietu_upload?filename="+a.download)
        // console.log(a.download);
        // a.click();

    }

    function dataURLtoFile(dataurl, filename) {//将base64转换为文件，dataurl为base64字符串，filename为文件名（必须带后缀名，如.jpg,.png）
        var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
            bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
        while(n--){
            u8arr[n] = bstr.charCodeAt(n);
        }
        this.fileList = new File([u8arr], filename, {type:mime});
        return this.fileList;
    }
    var int;
    function start1(){
        int=self.setInterval(cheis,3100)
        return int
    }

</script>
</body>
</html>
